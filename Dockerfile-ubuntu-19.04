FROM arm64v8/ubuntu:19.04
RUN mkdir /arm64 && set -ex \
    && sed -i -- 's/# deb-src/deb-src/g' /etc/apt/sources.list \
    && apt-get update \
    && apt-get install -y \
    			bash-static \
    			libncurses-dev \
    			flex \
    			bison \
    			libssl-dev \
    			dkms \
    			libelf-dev \
    			qemu-user-static \
    			libc6-amd64-cross \
    && apt-get build-dep -y linux-image-generic \
    && apt-get install -y build-essential autoconf automake \
    libtool gawk alien fakeroot ksh \
    && apt-get install -y zlib1g-dev uuid-dev libattr1-dev libblkid-dev \
    libselinux-dev libudev-dev \
    && apt-get install -y libacl1-dev libaio-dev libdevmapper-dev \
    && apt-get install -y python3 python3-dev python3-setuptools python3-cffi \
    && apt-get upgrade -y \
    && apt-get clean && rm -rf /tmp/* /var/tmp/*

FROM ubuntu:19.04
COPY --from=0 . arm64_chroot/
RUN set -ex \
    && sed -i -- 's/# deb-src/deb-src/g' /etc/apt/sources.list \
    && apt-get update \
    && apt-get install -y --no-install-recommends \
               apt-transport-https \
               build-essential \
               bc \
               bison \
               binfmt-support \
               ca-certificates \
               ccache \
               cdbs \
               cmake \
               cpio \
               curl \
               debhelper \
               devscripts \
               dkms \
               dosfstools \
               dpkg-dev \
               e2fsprogs \
               equivs \
               fakeroot \
               flex \
               gawk \
               git \
               kernel-package \
               kpartx \
               libgpm2 \
               lsof \
               lz4 \
               libc6-arm64-cross \
               libelf-dev \
               libncurses-dev \
               libssl-dev \
               libxdelta2 \
               libpython3.7 \
               moreutils \
               ncurses-dev \
               patch \
               piuparts \
               psmisc \
               pv \
               qemu-user-static \
               rsync \
               sbuild \
               sudo \
               ubuntu-dev-tools \
               u-boot-tools \
               vim \
               vim-common \
               vim-runtime \
               wget \
               xdelta3 \
               xxd \
               xz-utils \         
    && apt-get build-dep -y linux-image-raspi2 \
    && apt-get build-dep -y linux-image-generic \
    && apt-get upgrade -y
RUN ["/bin/bash", "-c", "[[ ! $(uname -m) = aarch64 ]] && (apt-get install -y --no-install-recommends gcc-aarch64-linux-gnu \
               cpp-aarch64-linux-gnu \
               g++-aarch64-linux-gnu \
               gcc-9-aarch64-linux-gnu \
               cpp-9-aarch64-linux-gnu \
               g++-9-aarch64-linux-gnu \
               gcc-9-aarch64-linux-gnu-base \
               libgcc-9-dev-arm64-cross \
               libstdc++-9-dev-arm64-cross)"]
RUN set -ex && update-alternatives --set gcc "/usr/bin/gcc-9" && update-alternatives --set g++ "/usr/bin/g++-9" && update-alternatives --set cpp "/usr/bin/cpp-9"
RUN ["/bin/bash", "-c", "[[ ! $(uname -m) = aarch64 ]] && (ln -sf /usr/aarch64-linux-gnu/lib /lib/aarch64-linux-gnu && ln -sf /usr/aarch64-linux-gnu/lib/ld-linux-aarch64.so.1 /lib/ld-linux-aarch64.so.1 && cat <<-EOF> /etc/ld.so.conf.d/aarch64-linux-gnu.conf
	# Multiarch support
	/usr/local/lib/aarch64-linux-gnu
	/lib/aarch64-linux-gnu
	/usr/lib/aarch64-linux-gnu
EOF)"]
RUN set -ex && apt-get clean && rm -rf /tmp/* /var/tmp/*



    




